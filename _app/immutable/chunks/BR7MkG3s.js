import{as as l,at as _,au as d,av as m,o as b,aw as p,v as g,A as v,ax as k,ay as w,aa as u,b as y,az as M}from"./B1DpfaPL.js";class z{anchor;#t=new Map;#s=new Map;#e=new Map;#i=new Set;#r=!0;constructor(s,t=!0){this.anchor=s,this.#r=t}#a=()=>{var s=l;if(this.#t.has(s)){var t=this.#t.get(s),e=this.#s.get(t);if(e)_(e),this.#i.delete(t);else{var a=this.#e.get(t);a&&(this.#s.set(t,a.effect),this.#e.delete(t),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),e=a.effect)}for(const[r,c]of this.#t){if(this.#t.delete(r),r===s)break;const i=this.#e.get(c);i&&(d(i.effect),this.#e.delete(c))}for(const[r,c]of this.#s){if(r===t||this.#i.has(r))continue;const i=()=>{if(Array.from(this.#t.values()).includes(r)){var n=document.createDocumentFragment();k(c,n),n.append(b()),this.#e.set(r,{effect:c,fragment:n})}else d(c);this.#i.delete(r),this.#s.delete(r)};this.#r||!e?(this.#i.add(r),m(c,i,!1)):i()}}};#n=s=>{this.#t.delete(s);const t=Array.from(this.#t.values());for(const[e,a]of this.#e)t.includes(e)||(d(a.effect),this.#e.delete(e))};ensure(s,t){var e=l,a=w();if(t&&!this.#s.has(s)&&!this.#e.has(s))if(a){var r=document.createDocumentFragment(),c=b();r.append(c),this.#e.set(s,{effect:p(()=>t(c)),fragment:r})}else this.#s.set(s,p(()=>t(this.anchor)));if(this.#t.set(e,s),a){for(const[i,o]of this.#s)i===s?e.skipped_effects.delete(o):e.skipped_effects.add(o);for(const[i,o]of this.#e)i===s?e.skipped_effects.delete(o.effect):e.skipped_effects.add(o.effect);e.oncommit(this.#a),e.ondiscard(this.#n)}else g&&(this.anchor=v),this.#a()}}function q(f,s,t){if(f==null)return s(void 0),u;const e=y(()=>f.subscribe(s,t));return e.unsubscribe?()=>e.unsubscribe():e}const h=[];function A(f,s=u){let t=null;const e=new Set;function a(i){if(M(f,i)&&(f=i,t)){const o=!h.length;for(const n of e)n[1](),h.push(n,f);if(o){for(let n=0;n<h.length;n+=2)h[n][0](h[n+1]);h.length=0}}}function r(i){a(i(f))}function c(i,o=u){const n=[i,o];return e.add(n),e.size===1&&(t=s(a,r)||u),i(f),()=>{e.delete(n),e.size===0&&t&&(t(),t=null)}}return{set:a,update:r,subscribe:c}}function B(f){let s;return q(f,t=>s=t)(),s}export{z as B,B as g,q as s,A as w};
