import{ar as l,as as _,at as d,au as m,j as b,av as p,l as g,w as v,aw as k,ax as w,a7 as u,u as y,ay as M}from"./JsQDOTzm.js";class z{anchor;#t=new Map;#s=new Map;#e=new Map;#i=new Set;#r=!0;constructor(s,t=!0){this.anchor=s,this.#r=t}#n=()=>{var s=l;if(this.#t.has(s)){var t=this.#t.get(s),e=this.#s.get(t);if(e)_(e),this.#i.delete(t);else{var n=this.#e.get(t);n&&(this.#s.set(t,n.effect),this.#e.delete(t),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),e=n.effect)}for(const[r,c]of this.#t){if(this.#t.delete(r),r===s)break;const i=this.#e.get(c);i&&(d(i.effect),this.#e.delete(c))}for(const[r,c]of this.#s){if(r===t||this.#i.has(r))continue;const i=()=>{if(Array.from(this.#t.values()).includes(r)){var a=document.createDocumentFragment();k(c,a),a.append(b()),this.#e.set(r,{effect:c,fragment:a})}else d(c);this.#i.delete(r),this.#s.delete(r)};this.#r||!e?(this.#i.add(r),m(c,i,!1)):i()}}};#a=s=>{this.#t.delete(s);const t=Array.from(this.#t.values());for(const[e,n]of this.#e)t.includes(e)||(d(n.effect),this.#e.delete(e))};ensure(s,t){var e=l,n=w();if(t&&!this.#s.has(s)&&!this.#e.has(s))if(n){var r=document.createDocumentFragment(),c=b();r.append(c),this.#e.set(s,{effect:p(()=>t(c)),fragment:r})}else this.#s.set(s,p(()=>t(this.anchor)));if(this.#t.set(e,s),n){for(const[i,o]of this.#s)i===s?e.skipped_effects.delete(o):e.skipped_effects.add(o);for(const[i,o]of this.#e)i===s?e.skipped_effects.delete(o.effect):e.skipped_effects.add(o.effect);e.oncommit(this.#n),e.ondiscard(this.#a)}else g&&(this.anchor=v),this.#n()}}function q(f,s,t){if(f==null)return s(void 0),u;const e=y(()=>f.subscribe(s,t));return e.unsubscribe?()=>e.unsubscribe():e}const h=[];function A(f,s=u){let t=null;const e=new Set;function n(i){if(M(f,i)&&(f=i,t)){const o=!h.length;for(const a of e)a[1](),h.push(a,f);if(o){for(let a=0;a<h.length;a+=2)h[a][0](h[a+1]);h.length=0}}}function r(i){n(i(f))}function c(i,o=u){const a=[i,o];return e.add(a),e.size===1&&(t=s(n,r)||u),i(f),()=>{e.delete(a),e.size===0&&t&&(t(),t=null)}}return{set:n,update:r,subscribe:c}}function B(f){let s;return q(f,t=>s=t)(),s}export{z as B,B as g,q as s,A as w};
